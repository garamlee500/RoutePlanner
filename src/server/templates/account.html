<!DOCTYPE html>
<html lang="en" style="height:100%">
    <head>
        <meta charset="UTF-8"/>
        <title>Account</title>
        <script>
            async function make_public(route_id, is_public){
                await fetch("/api/post/public_route", {
                        method: "POST",
                        body: JSON.stringify({
                            route_id: route_id,
                            is_public: is_public
                        }),
                        headers: {
                            "Content-type": "application/json; charset=UTF-8"
                        }
                    }
                );
            }
        </script>
    </head>
    <body>
        <a href="/">Home</a>
        <br>
        <form action="/logout">
            <input type="submit" value="Logout"/>
        </form>
        <br>
        Hello {{ username }}! Found {{ saved_routes|length }} saved routes in account:
        <br>
        {% for route in saved_routes %}
            <a href="/?route={{ route[2] }}">{{ route[1] }} - {{ route[4] }}</a>: Public? -
            <input id={{ "public_checkbox" ~ route[0]}} type="checkbox"/>
            <br>
            <script>
                {# Note route ids are safe as they all originate from sql database
                 where we know all data is integral - autoescaping prevents execution of script #}
                document.getElementById({{ ("'public_checkbox" ~ route[0] + "'") | safe}}).checked = {{ "true" if route[5]==1 else "false"}};
                document.getElementById({{ ("'public_checkbox" ~ route[0] + "'") | safe}}).addEventListener(
                    "change",
                    (event)=>{make_public({{ route[0] }}, event.target.checked)});

            </script>
        {% endfor %}

        Try some popular routes in your region:
        <br>
        {% for route in popular_routes %}
            <a href="#">{{ route[2] }} by {{ route[3] }}</a> - Average rating {{ route[4] }}/5 - {{ route[5] }} reviews
            <br>
        {% endfor %}

        Try some random routes in your region:
        <br>
        {% for route in random_routes %}
            <a href="#">{{ route[2] }} by {{ route[3] }}</a> - Average rating {{ route[4] }}/5 - {{ route[5] }} reviews
            <br>
        {% endfor %}
    </body>
</html>